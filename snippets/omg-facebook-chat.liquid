<script id="omgfbc-script" type='text/javascript' data-type="custom">
    var facebookChatSettings = {"id":"82283","shop":"vicinity-mart.myshopify.com","script_tag_id":null,"page_info":null,"language":"en_US","position":"90","greeting_message":"Hi! How can we help you?","icon_type":"icon_1","icon_text":"Chat With Us","tab_size":"medium","auto_display":"0","tab_color":"#ffffff","icon_text_color":"#0084ff","theme_color":"#0084ff","custom_css":null,"working_time":{"status":"1","start":"01:00","end":"23:59","time_zone":"America\/Denver"},"status_connect":"0","app_status":"1","device_target":"0","page_target":"0","margin_bottom":"30","chat_type":"0","exclude_pages":["template-cart"],"specific_pages":["template-index"],"plan":"free","active_plan_at":"1637544658","last_access":"0","deleted":"0","shop_info":{"id":58660913302,"name":"Vicinity Mart","email":"arman@vicinitymart.com","domain":"vicinitymart.com","province":"British Columbia","country":"CA","address1":"1075 West 1st Street","zip":"V7P 3T4","city":"North Vancouver","source":null,"phone":"6043967447","latitude":49.3173855,"longitude":-123.1043413,"primary_locale":"en","address2":"107","created_at":"2021-08-17T16:18:20-07:00","updated_at":"2021-11-21T17:27:36-08:00","country_code":"CA","country_name":"Canada","currency":"CAD","customer_email":"support@vicinitymart.com","timezone":"(GMT-08:00) America\/Vancouver","iana_timezone":"America\/Vancouver","shop_owner":"Arman Fazly","money_format":"${{amount}}","money_with_currency_format":"${{amount}} CAD","weight_unit":"kg","province_code":"BC","taxes_included":false,"auto_configure_tax_inclusivity":null,"tax_shipping":null,"county_taxes":true,"plan_display_name":"Basic Shopify","plan_name":"basic","has_discounts":false,"has_gift_cards":false,"myshopify_domain":"vicinity-mart.myshopify.com","google_apps_domain":null,"google_apps_login_enabled":null,"money_in_emails_format":"${{amount}}","money_with_currency_in_emails_format":"${{amount}} CAD","eligible_for_payments":true,"requires_extra_payments_agreement":false,"password_enabled":true,"has_storefront":true,"eligible_for_card_reader_giveaway":false,"finances":true,"primary_location_id":65029931158,"cookie_consent_level":"implicit","visitor_tracking_consent_preference":"allow_all","checkout_api_supported":true,"multi_location_enabled":true,"setup_required":false,"pre_launch_enabled":false,"enabled_presentment_currencies":["CAD"]},"weekdays":[{"name":"Sunday","id":"0"},{"name":"Monday","id":"1"},{"name":"Tuesday","id":"2"},{"name":"Wednesday","id":"3"},{"name":"Thursday","id":"4"},{"name":"Friday","id":"5"},{"name":"Saturday","id":"6"}],"show_after":"0","update_cache":"0","tab_style":"two_box","version_app":"1","theme_publish":"0","display_mode":"customize","setting_page":"0","front_check":"0","error_connect_page":"{\"show\":false,\"errorAdmin\":2,\"errorAge\":2,\"errorCountry\":2,\"errorPrivate\":2}","white_list_domain":"","customer_question":"","guide_step":"{\"current_step\": 0 }","customer_error":"0","infomation_fb_user":null,"show_greeting_message":"1","enable_fb_chat_btn":"0","facebook_message_options":"0","enable_abandoned_campaign":"0","fb_page_id":"0","app_fb_id":"0","urlApp":"https:\/\/apps.omegatheme.com\/facebook-chat\/","abTests":[],"addCartWidget":null,"appIdFB":"0"};
    var iconHtml = {"icon_1":"<svg xmlns='http:\/\/www.w3.org\/2000\/svg' width='25' height='25' viewBox='96 93 322 324'><g><path d='M257 93c-88.918 0-161 67.157-161 150 0 47.205 23.412 89.311 60 116.807V417l54.819-30.273C225.449 390.801 240.948 393 257 393c88.918 0 161-67.157 161-150S345.918 93 257 93zm16 202l-41-44-80 44 88-94 42 44 79-44-88 94z'><\/path><rect x='13.445' y='20.996' width='37' height='4'><\/rect><rect x='13.445' y='32.828' width='37' height='4'><\/rect><rect x='13.445' y='44.66' width='37' height='4'><\/rect><\/g><\/svg>","icon_2":"<svg xmlns='http:\/\/www.w3.org\/2000\/svg' width='25' height='25' viewBox='0 0 24 24'><path d='M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z'><\/path><\/svg>","icon_3":"<svg width='25' height='25' version='1.1' id='Capa_1' xmlns='http:\/\/www.w3.org\/2000\/svg' xmlns:xlink='http:\/\/www.w3.org\/1999\/xlink' x='0px' y='0px' viewBox='0 0 88.695 88.695' xml:space='preserve'> <g><path d='M84.351,68.07c2.508-4.59,3.829-9.759,3.829-15.006c0-13.118-8.112-24.36-19.575-29.021 C62.65,12.338,50.493,4.295,36.486,4.295c-19.862,0-36.021,16.159-36.021,36.021c0,6.072,1.541,12.057,4.462,17.36L0,76.059 l18.011-4.824c5.403,3.236,11.549,4.975,17.862,5.082c5.558,5.019,12.913,8.083,20.973,8.083c5.64,0,11.142-1.512,15.971-4.379 l15.878,4.254L84.351,68.07z M18.655,66.921L5.657,70.402l3.561-13.285l-0.419-0.72c-2.835-4.873-4.334-10.434-4.334-16.082 c0-17.656,14.365-32.021,32.021-32.021s32.021,14.364,32.021,32.021S54.142,72.337,36.486,72.337 c-6.066,0-11.976-1.711-17.091-4.948L18.655,66.921z M83.037,78.618l-10.861-2.91l-0.74,0.468C67.07,78.94,62.025,80.4,56.847,80.4 c-5.511,0-10.633-1.656-14.93-4.473c17.294-2.626,30.59-17.595,30.59-35.611c0-3.712-0.565-7.294-1.612-10.667 c7.947,4.786,13.286,13.48,13.286,23.415c0,4.823-1.28,9.57-3.701,13.728l-0.419,0.72L83.037,78.618z'><\/path><\/g><\/svg>","icon_4":"<svg width='25' height='25' version='1.1' id='Capa_1' xmlns='http:\/\/www.w3.org\/2000\/svg' xmlns:xlink='http:\/\/www.w3.org\/1999\/xlink' x='0px' y='0px' viewBox='0 0 81.146 81.146' xml:space='preserve'><g><path d='M11.902,67.18l0.021-14.51L0,52.559V8.524h64.319v44.053h-31.25L11.902,67.18z M4,48.596l11.928,0.111l-0.016,10.846 l15.911-10.976h28.496V12.524H4V48.596z'><\/path><path d='M81.146,26.524H64.319v-18H0v44.035l11.922,0.111l-0.021,14.51L31.16,53.895v7.167h24.152l16.763,11.561l-0.018-11.495 l9.089-0.084V26.524z M4,48.596V12.524h56.319v36.053H31.823L15.912,59.553l0.016-10.846L4,48.596z M77.146,57.08l-9.095,0.084 l0.012,7.833l-11.505-7.936H35.16v-4.484h29.159V30.524h12.827C77.146,30.524,77.146,57.08,77.146,57.08z'><\/path><\/g><\/svg>","icon_5":"<svg width='25' height='25' version='1.1' id='Capa_1' xmlns='http:\/\/www.w3.org\/2000\/svg' xmlns:xlink='http:\/\/www.w3.org\/1999\/xlink' x='0px' y='0px' viewBox='0 0 75.333 75.333' xml:space='preserve'><g><path d='M37.666,75.318l-9.413-16.303H17c-9.374,0-17-7.626-17-17v-25c0-9.374,7.626-17,17-17h41.333c9.374,0,17,7.626,17,17v25 c0,9.374-7.626,17-17,17H47.078L37.666,75.318z M17,4.016c-7.168,0-13,5.832-13,13v25c0,7.168,5.832,13,13,13h13.563l7.103,12.302 l7.104-12.303h13.563c7.168,0,13-5.832,13-13v-25c0-7.168-5.832-13-13-13L17,4.016L17,4.016z'><\/path><circle cx='54.822' cy='31.128' r='4.206'><\/circle><circle cx='37.667' cy='31.128' r='4.206'><\/circle><circle cx='20.511' cy='31.128' r='4.206'><\/circle><\/g><\/svg>","icon_6":"<svg width='25' height='25' version='1.1' id='Capa_1' xmlns='http:\/\/www.w3.org\/2000\/svg' xmlns:xlink='http:\/\/www.w3.org\/1999\/xlink' x='0px' y='0px' viewBox='0 0 71.015 71.015' xml:space='preserve'><g><circle cx='52.46' cy='27.353' r='4.206'><\/circle><circle cx='35.306' cy='27.353' r='4.206'><\/circle><circle cx='18.151' cy='27.353' r='4.206'><\/circle><path d='M13.223,67.769l0.022-15.916L0,51.728V3.247h71.015v48.5H36.448L13.223,67.769z M4,47.765l13.25,0.125l-0.017,12.252 l17.968-12.396h31.813v-40.5H4V47.765z'><\/path><\/g><\/svg>","icon_7":"<svg xmlns='http:\/\/www.w3.org\/2000\/svg' width='25' height='25' viewBox='0 0 512 512'><path d='M456,224V200a8,8,0,0,0-8-8h-8.18C435.61,94.24,354.78,16,256,16S76.39,94.24,72.18,192H64a8,8,0,0,0-8,8v24A48.051,48.051,0,0,0,8,272v96a48.051,48.051,0,0,0,48,48h8v16a48.051,48.051,0,0,0,48,48H216v8a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V456a8,8,0,0,0-8-8H224a8,8,0,0,0-8,8v8H112a32.036,32.036,0,0,1-32-32V416h32a8,8,0,0,0,8-8V392h4a28.031,28.031,0,0,0,28-28V276a28.031,28.031,0,0,0-28-28h-4V200c0-74.99,61.01-136,136-136s136,61.01,136,136v48h-4a28.031,28.031,0,0,0-28,28v88a28.031,28.031,0,0,0,28,28h4v16a8,8,0,0,0,8,8h56a48.051,48.051,0,0,0,48-48V272A48.051,48.051,0,0,0,456,224ZM232,464h48v16H232Zm160-88h-4a12.01,12.01,0,0,1-12-12V276a12.01,12.01,0,0,1,12-12h4Zm48-168v16H408V208ZM104,400H56a32.036,32.036,0,0,1-32-32V272a32.036,32.036,0,0,1,32-32h48Zm0-176H72V208h32Zm20,40a12.01,12.01,0,0,1,12,12v88a12.01,12.01,0,0,1-12,12h-4V264ZM256,48c-81.13,0-147.62,63.89-151.79,144H88.19C92.39,103.06,166.05,32,256,32s163.61,71.06,167.81,160H407.79C403.62,111.89,337.13,48,256,48ZM488,368a32.036,32.036,0,0,1-32,32H408V240h48a32.036,32.036,0,0,1,32,32Z'><\/path><\/svg>","icon_8":"<svg xmlns='http:\/\/www.w3.org\/2000\/svg' height='25' viewBox='0 0 512 512' width='25'><path d='m464 48h-320a40.045 40.045 0 0 0 -40 40v64h-56a40.045 40.045 0 0 0 -40 40v160a40.045 40.045 0 0 0 40 40h40v72a8 8 0 0 0 13.657 5.657l77.657-77.657h188.686a40.045 40.045 0 0 0 40-40v-64h56a40.045 40.045 0 0 0 40-40v-160a40.045 40.045 0 0 0 -40-40zm-72 304a24.027 24.027 0 0 1 -24 24h-192a8 8 0 0 0 -5.657 2.343l-66.343 66.343v-60.686a8 8 0 0 0 -8-8h-48a24.027 24.027 0 0 1 -24-24v-160a24.027 24.027 0 0 1 24-24h320a24.027 24.027 0 0 1 24 24zm96-104a24.027 24.027 0 0 1 -24 24h-56v-80a40.045 40.045 0 0 0 -40-40h-248v-64a24.027 24.027 0 0 1 24-24h320a24.027 24.027 0 0 1 24 24z'><\/path><path d='m208 248a32 32 0 1 0 32 32 32.036 32.036 0 0 0 -32-32zm0 48a16 16 0 1 1 16-16 16.019 16.019 0 0 1 -16 16z'><\/path><path d='m112 248a32 32 0 1 0 32 32 32.036 32.036 0 0 0 -32-32zm0 48a16 16 0 1 1 16-16 16.019 16.019 0 0 1 -16 16z'><\/path><path d='m304 312a32 32 0 1 0 -32-32 32.036 32.036 0 0 0 32 32zm0-48a16 16 0 1 1 -16 16 16.019 16.019 0 0 1 16-16z'><\/path><path d='m336 344h-72a8 8 0 0 0 0 16h72a8 8 0 0 0 0-16z'><\/path><path d='m368 344h-8a8 8 0 0 0 0 16h8a8 8 0 0 0 0-16z'><\/path><\/svg>","icon_9":"<svg xmlns='http:\/\/www.w3.org\/2000\/svg' height='25' viewBox='0 -12 496 495' width='25'><path d='m472 192.5h-56v-168c0-13.253906-10.746094-24-24-24h-368c-13.253906 0-24 10.746094-24 24v264c0 13.253906 10.746094 24 24 24h24v88c0 3.367188 2.109375 6.371094 5.273438 7.519531 3.167968 1.152344 6.71875.191407 8.878906-2.398437l77.601562-93.121094h52.246094v80c0 13.253906 10.746094 24 24 24h193.199219l32 52.175781c1.878906 3.03125 5.539062 4.453125 8.972656 3.484375s5.8125-4.09375 5.828125-7.660156v-48h16c13.253906 0 24-10.746094 24-24v-176c0-13.253906-10.746094-24-24-24zm-336 104c-2.375-.003906-4.628906 1.046875-6.152344 2.871094l-65.847656 79.03125v-73.902344c0-4.417969-3.582031-8-8-8h-32c-4.417969 0-8-3.582031-8-8v-264c0-4.417969 3.582031-8 8-8h368c4.417969 0 8 3.582031 8 8v168h-184c-13.253906 0-24 10.746094-24 24v80zm344 96c0 4.417969-3.582031 8-8 8h-24c-4.417969 0-8 3.582031-8 8v27.632812l-19.503906-31.808593c-1.453125-2.375-4.035156-3.820313-6.816406-3.824219h-197.679688c-4.417969 0-8-3.582031-8-8v-176c0-4.417969 3.582031-8 8-8h256c4.417969 0 8 3.582031 8 8zm0 0'><\/path><path d='m344 280.5c-13.253906 0-24 10.746094-24 24s10.746094 24 24 24 24-10.746094 24-24-10.746094-24-24-24zm0 32c-4.417969 0-8-3.582031-8-8s3.582031-8 8-8 8 3.582031 8 8-3.582031 8-8 8zm0 0'><\/path><path d='m416 280.5c-13.253906 0-24 10.746094-24 24s10.746094 24 24 24 24-10.746094 24-24-10.746094-24-24-24zm0 32c-4.417969 0-8-3.582031-8-8s3.582031-8 8-8 8 3.582031 8 8-3.582031 8-8 8zm0 0'><\/path><path d='m272 280.5c-13.253906 0-24 10.746094-24 24s10.746094 24 24 24 24-10.746094 24-24-10.746094-24-24-24zm0 32c-4.417969 0-8-3.582031-8-8s3.582031-8 8-8 8 3.582031 8 8-3.582031 8-8 8zm0 0'><\/path><\/svg>"}; 
    var rootLinkChat = facebookChatSettings.urlApp;
    var shopFbChat = facebookChatSettings.shop;
    var isStyleLoadingDone = false
    var OMGChatIsLiquidFile = true // compare with script tag
    // append css app
    const OMGFBhead = document.getElementsByTagName('head')[0];
    let style = document.createElement('link');
    style.href = `${rootLinkChat}client/omg-facebook-chat_style.css?v=${Math.floor(Date.now() / 1000)}`;
    style.type = 'text/css';
    style.rel = 'stylesheet';
    style.onload = () => {
        isStyleLoadingDone = true
    }
    OMGFBhead.appendChild(style);

    function loadJqueryChat(callback) {
        if (typeof jQuery === "undefined") {
            getScript({
                source: "//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",
                callback: () => {
                    jQuery224 = jQuery.noConflict(true);
                    callback(jQuery224);
                },
            });
        } else {
            callback(jQuery);
        }
    }

    function getScript({ source, callback }) {
        var script = document.createElement("script");
        var prior = document.getElementsByTagName("script")[0];
        script.async = 1;

        script.onload = script.onreadystatechange = function (_, isAbort) {
            if (
                isAbort ||
                !script.readyState ||
                /loaded|complete/.test(script.readyState)
            ) {
                script.onload = script.onreadystatechange = null;
                script = undefined;

                if (!isAbort) {
                    if (callback) callback();
                }
            }
        };

        script.src = source;
        prior.parentNode.insertBefore(script, prior);
    }

    function checkInstallApp(jQuery){
        return new Promise(resolve => {
            jQuery.ajax({
                url: rootLinkChat + `backend/storefront/facebook-message.php?action=checkInstallApp&shop=${shopFbChat}`,
                dataType: "json",
                type: "GET",
                success: function (data) { resolve(data); },
            })
        })
    }

    const waitBodyLoad = setInterval(() => {
        if (document.getElementsByTagName("body")[0] && window.__st && isStyleLoadingDone) {
            var body = document.getElementsByTagName("body")[0];
            let elementChat = document.createElement('div');
            elementChat.className = 'otFacbookChat';
            body.appendChild(elementChat);
            loadJqueryChat(async function(jQuery) {
                const appStatus = await checkInstallApp(jQuery)

                if (appStatus) {
                    createFacebookChat(jQuery);
                }
            });
            clearInterval(waitBodyLoad)
        }
    })

    {% render 'facebook-chat.js' %}
</script> 